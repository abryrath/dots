console.log("+++++++++++++++++++++++++++++++++++ starting MightyText CRX +++++++++++++++++++++++++++++++++++\n\n");_40421d6eb1a359f2f822a28b0f0f93da0d4bbf00("default-icon-on-background-start");
var baseUrl="https://textyserver.appspot.com",contactsFromPhoneGlobal=[],manifest=chrome.runtime.getManifest(),globalIntervalGetPhoneStatus,webapp_crx_globalUserSettingsUponCRXLoad,username_prefix_jstrg_purpose,google_username_currently_logged_in,isAProUser=!1,global_time_last_push_rcvd=new Date,webapp_crx_time_last_channel_token_obtained=new Date,webapp_crx_time_last_successful_health_check_received=new Date,time_last_success_mighty_ping=new Date,notify_android_app_install_once=!1,globalPHONEContactsRefreshCacheQueue=
[],signInUrlCRX=baseUrl+"/signin?extret="+encodeURIComponent(chrome.extension.getURL("help.html"))+"%23signed_in&ver="+manifest.version,registerUrl=baseUrl+"/register?ver="+manifest.version,NEW_COUNT_GLOBAL_NOTIF=0,global_count_request_phone_status=0,deviceNotifManagerArray={},capi_helper_global_login_state="UNKNOWN",globalMsUntilShowNotLoggedInNotifAgain=36E5,globalLastKnownSystemStatus="UNKNOWN",globalSystemIdleStatusThresholdInSeconds=60,globalUserOS="unknown",_gaq=_gaq||[];
_gaq.push(["_setAccount","UA-21391541-14"]);(function(){var a=document.createElement("script");a.type="text/javascript";a.async=!0;a.src="https://ssl.google-analytics.com/ga.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)})();var _kmq=_kmq||[],_kmk=_kmk||"a009d9e3633da7d7456e8e1478c8f05f33e35f8e";
function _kms(a){setTimeout(function(){var b=document,c=b.getElementsByTagName("script")[0];b=b.createElement("script");b.type="text/javascript";b.async=!0;b.src=a;c.parentNode.insertBefore(b,c)},1)}_kms("https://i.kissmetrics.com/i.js");_kms("https://scripts.kissmetrics.com/"+_kmk+".2.js");_kms("../scripts/km_secure.js");
(function(){var a=window,b=a.Intercom;if("function"===typeof b)b("reattach_activator"),b("update",intercomSettings);else{b=function(){var a=c.createElement("script");a.type="text/javascript";a.async=!0;a.src="https://widget.intercom.io/widget/7guo5kws";var b=c.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)};var c=document,d=function(){d.c(arguments)};d.q=[];d.c=function(a){d.q.push(a)};a.Intercom=d;a.attachEvent?a.attachEvent("onload",b):a.addEventListener("load",b,!1)}})();_a8f2823c341af5dcabb327d2596824740bd3c308();
var globalHeartbeatInterval=setInterval(_d71e4d9d9000887fe9fe1d87fb1e83f7282c2d82,1E4),globalBrowserActionIconCheckerInterval=setInterval(function(){_96e43ca09b9d1d84dbc17c4af23e900d6c3c9b41()},3E5),globalLockedNotificationCleanupInterval=setInterval(_a1ead672229f200085f6eddfef8922fa652841ea,6E4);17===_c74b7efa9d15c055a086e9938f6bac8ac50e9b11(0,100)&&_gaq.push(["_trackEvent","Background","Startup-BG-Script-1pct-Sample",manifest.version]);_643fc0591de8194e289b4a026a2d05934205e146();
var flushedJstorageOnce=window.localStorage.crx_upgrade_jstorage_flushed;if(!flushedJstorageOnce)throw $.jStorage.flush(),window.localStorage.crx_upgrade_jstorage_flushed=1,setTimeout(function(){_1c44fb4dd48d453d8f5dbe5e058ac3fc96cb7789("Flushed-Jstorage")},1E3),console.log("javascript should stop executing now."),Error("Stopping JS to restart the CRX before any new jstorage values are set.");_a97243671d78b8600fbbb6f6ecdaff212f904910(1,!0);_8aed0f6d89538ba54e55ea25536b83c850752e10();
function _8aed0f6d89538ba54e55ea25536b83c850752e10(){chrome.runtime.getPlatformInfo(function(a){"mac"==a.os?globalUserOS="Mac":"win"==a.os&&(globalUserOS="Windows")})}$(document).ready(_cc921bad2b1ad9168e4b3743ae15cfc2d1f0ba60);function _d71e4d9d9000887fe9fe1d87fb1e83f7282c2d82(){console.log("User is not logged in.  Checking when we last successfully made a request to textyserver.");checkLastMightyNetworkPing()}
function checkLastMightyNetworkPing(){var a=((new Date).getTime()-time_last_success_mighty_ping.getTime())/1E3;console.log("--------------\x3e Seconds Since LAST MightyText network ping: "+a);3600<a&&(_5f4240ca7eb7e3c1748ce1230ac93093f6e54c9b("---\x3e has been a long time since last MT ping -- try to contact google.com first","red"),$.ajax({type:"GET",url:"https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js",dataType:"text",cache:!1,success:function(a){console.log("Network ping to Google -- fine...");
console.log("User is not logged in and there is an internet connection, but we have not received a response from texty server for over 60 minutes.  Will reload CRX BG in 10 seconds.");_1c44fb4dd48d453d8f5dbe5e058ac3fc96cb7789("Checking-Last-MightyNetwork-Ping")}}))}function _3b5a053b3b3ee909b82442c571bd6663fa08917e(){_f7f5d29e57d96e6a8c4b85b3593e810d83b3fc28();checkLastMightyNetworkPing();console.log("-------------------------\x3e Heartbeat WEBAPP USER @ "+Date()+" ###")}
function _a97243671d78b8600fbbb6f6ecdaff212f904910(a,b){a||(a=1);$.ajax({url:baseUrl+"/api?function=getUserInfoFull&CLIENT=CRX",type:"GET",timeout:5E3,dataType:"json",error:function(b,d,e){!navigator.onLine&&3>=a?(_40421d6eb1a359f2f822a28b0f0f93da0d4bbf00("no-internet"),_63de837b18c2510e350642aa942a12a1c619a018()):(console.log("On retry attempt #"+a+" -- ERROR in AJAX in getUserInfoFull: "+e),3<a?_1c3fdd65ce756c363b7549fb76d3b1a2ad376495(_f5b5f2dccc9776a9e6c351a57c72135c2cd40d10,_63de837b18c2510e350642aa942a12a1c619a018):
window.setTimeout(function(){_a97243671d78b8600fbbb6f6ecdaff212f904910(a+1)},2E3))},success:function(a,b,e){console.log(a);time_last_success_mighty_ping=new Date;a.user&&-1<a.user.indexOf("user not logged in")?(1>Math.floor(100*Math.random())&&_gaq.push(["_trackEvent","CRX-Background","Error","User-Not-Logged-In-CRX-1Pct-Sample",1]),_bb8e340c9454e1a89957aaef19ce60280313d3eb(),_40421d6eb1a359f2f822a28b0f0f93da0d4bbf00("user-not-logged-in")):a.user_info_full&&0<a.user_info_full.email.length?(999==a.user_info_full.premium?
isAProUser=!0:1==a.user_info_full.premium&&a.billing_info&&(billingInfo=a.billing_info,"active"==a.billing_info.status||"past_due"==a.billing_info.status||"trialing"==a.billing_info.status)&&(isAProUser=!0),globalUserName=google_username_currently_logged_in=a.user_info_full.email,e=a.user_info_full.ts_creation,b=new Date,_kmq.push(["identify",google_username_currently_logged_in]),_402ce96ed9b37900757c9517bbc29e2cd9fe5f77(google_username_currently_logged_in,e,a,"CRX-MODERN-USER"),b=b.setHours(0,0,
0,0),e=$.jStorage.get("ts_last_kissmetrics_login_call","no-km-last-login-set"),"no-km-last-login-set"==e&&_gaq.push(["_trackEvent","Background","CRX-KM-Last-TS",e]),e==b?6>Math.floor(10*Math.random())&&(_kmq.push(["record","User Logged In",{"CRX-Login":"true",Client:"CRX","Dup-Intraday":"true"}]),$.jStorage.set("ts_last_kissmetrics_login_call",b)):(_kmq.push(["record","User Logged In",{"CRX-Login":"true",Client:"CRX","Dup-Intraday":"false",crx_login_version:manifest.version}]),Intercom("trackEvent",
"User-Logged-In-CRX",{Client:"CRX","App-Version":manifest.version}),$.jStorage.set("ts_last_kissmetrics_login_call",b),_31766a4c5c1786c575b42c7e777d2a0df57fd5e0({event:{name:"event_client_metric",options:{type:"logged-in",email:globalUserName}}})),void 0!=a.user_info_full.channelapi_enabled&&100==a.user_info_full.channelapi_enabled&&(username_prefix_jstrg_purpose=a.user_info_full.email.substr(0,a.user_info_full.email.indexOf("@")),_fe01d5d5cfdad287e8c9a67e27251a278ce5d30d(a.user_info_full),10>_c74b7efa9d15c055a086e9938f6bac8ac50e9b11(0,
100)&&_gaq.push(["_trackEvent","Background","CRX-User-Logged-In-10pct-Sample",manifest.version.toString()]),_4042d8bde9e24823b5bb7c2d3eaaac0786f9a4d2())):(-1!=a.user_status.search("not registered")?(_863c972e704630aff56fa7b4b8ebfd87c84ad479("NOT-REG"),console.log("user has not registered a device w/ MT"),notify_android_app_install_once||(a=_3508e249a7f2b6dae514b06f2467b28745bc2c3d({notif_options:{type:"basic",priority:2,title:_17b88bbdae4990e1a40e4c9175cb0cb5f572c185({key:"install_mt_notif_title"}),
message:_17b88bbdae4990e1a40e4c9175cb0cb5f572c185({key:"install_mt_notif_content"}).replace("%user_email%",a.email),contextMessage:_17b88bbdae4990e1a40e4c9175cb0cb5f572c185({key:"click_for_instructions"})+".",iconUrl:"../img/48x48_MT_logo_boom_gradient_white.png"}}),chrome.notifications.create("user-install-android-app",a,function(a){_d6b9fcb67a09bd160cbd5e5ba69e7eae5d02c6a7({notif_id:a,auto_dismiss:!1,notif_sound:!0});console.log('just created a notif with the ID: "'+a+'"')}),notify_android_app_install_once=
!0)):(a=_3508e249a7f2b6dae514b06f2467b28745bc2c3d({notif_options:{type:"basic",priority:2,title:"MightyText",message:_17b88bbdae4990e1a40e4c9175cb0cb5f572c185({key:"mt_gen_error_notif_content"}),iconUrl:"../img/notifications/error_icon.png"}}),chrome.notifications.create("getuserinfofull-general-error",a,function(a){_d6b9fcb67a09bd160cbd5e5ba69e7eae5d02c6a7({notif_id:a,auto_dismiss:!1,notif_sound:!0})})),_40421d6eb1a359f2f822a28b0f0f93da0d4bbf00("user-not-logged-in"))}})}
function _863c972e704630aff56fa7b4b8ebfd87c84ad479(a){2>Math.floor(80*Math.random())&&_kmq.push(["record","CRX-UserState-"+a])}
function _402ce96ed9b37900757c9517bbc29e2cd9fe5f77(a,b,c,d){b=Math.round((new Date(b)).getTime()/1E3);var e=c.user_info_full.current_app_version,f=Math.round((new Date(c.user_info_full.ts_last_login)).getTime()/1E3),h=c.user_info_full.ts_first_login,g=Math.round((new Date(h)).getTime()/1E3);console.log(c);intercomSettings={email:a,created_at:b,app_id:"7guo5kws",web_app:d,phone_app_version:e,ts_last_login_at:f,wagda:"DEC-2017",app_version:manifest.version,pro_user:"NO","day-last-seen":_9709c7d5693e2b7674afb63dfe2b89a90408c0cd()};
void 0!=h&&(intercomSettings.ts_first_login_at=g);isAProUser&&(intercomSettings.pro_user="YES");c.billing_info&&(intercomSettings.plan_id=c.billing_info.plan_id);c.user_info_full.phone_lang&&(intercomSettings["phone-lang"]=c.user_info_full.phone_lang);window.Intercom("boot",intercomSettings)}
function _fe01d5d5cfdad287e8c9a67e27251a278ce5d30d(a){setTimeout(function(){_95d3f58a8397c4ce39fcd6570201a6a346af71d1(a)},5E3);_e9fc47ca6881a211416a531bba112a3430815a23();_40421d6eb1a359f2f822a28b0f0f93da0d4bbf00("user-logged-in");_fd788344f8ead704356938ed655c3325989a6b61();_863c972e704630aff56fa7b4b8ebfd87c84ad479("REG-OK");clearInterval(globalHeartbeatInterval);globalHeartbeatInterval=setInterval(_3b5a053b3b3ee909b82442c571bd6663fa08917e,2E4);___getPhoneStatus();_c85df22ff6163ebdfc2c78620e927b244399863b({get_latest_notifs_for_existing:!0});
clearInterval(globalIntervalGetPhoneStatus);globalIntervalGetPhoneStatus=setInterval(___getPhoneStatus,24E4);_36560a2e9dd8c62fb5960626c698bac7c1e8572e();_afaed588c4e02b09e9515b381b458c329a2de73e({attempt:0});setTimeout(_c83649b1b98bfac47f7d22d4787ab79f85f2d1ea,timeBeforeCheckForPushServiceEnabled);_d13e3f092238f4536bd8166186d16a5abec1ba2e();_63de837b18c2510e350642aa942a12a1c619a018();_eaccde8c98ca0991e2cd03408a0aebf77a93d2bd({environment:"background"});_9660ed269440e08ad030d1e160f030ac78f892f9(a);
_8e2f24ae6391f4eb7d8eb0c1a43ea90dd6425708({details:a})}function _8e2f24ae6391f4eb7d8eb0c1a43ea90dd6425708(a){a=a.details;a.hasOwnProperty("current_app_version")&&(window.localStorage.current_phone_app_version=a.current_app_version);window.localStorage.is_pro=isAProUser;a.hasOwnProperty("my_referral_code")&&(window.localStorage[username_prefix_jstrg_purpose+"|referral_url"]="http://mightytext.net/"+a.my_referral_code)}
function _d13e3f092238f4536bd8166186d16a5abec1ba2e(a){"undefined"===typeof a&&(a=0);_5f4240ca7eb7e3c1748ce1230ac93093f6e54c9b("trying to call getThreads! Try count: "+a);$.ajax({url:baseUrl+"/api?function=GetDistinctMessageHeaders&CLIENT=CRX",type:"GET",timeout:1E4,dataType:"json",error:function(b,c,d){1>a?(a++,_d13e3f092238f4536bd8166186d16a5abec1ba2e(a)):_1c3fdd65ce756c363b7549fb76d3b1a2ad376495(_40fcc753c277a76d6986a340c219006a3995f7a9)},success:function(a,c,d){$.each(a.messages,function(a,b){0==
b.phone_num_clean&&(b.phone_num="Unknown / Misc");var c=$.jStorage.get(username_prefix_jstrg_purpose+"|PC_"+b.phone_num_clean,"no-jstorage-val-found");"no-jstorage-val-found"==c?(c=_136a6d5a80cc1799beb5584146db9c085f945709(b.phone_num_clean),console.log("NO LOCAL JSTORAGE CONTACT NAME MATCH FOR PHONE_NUM_CLEAN: "+b.phone_num_clean+" ... now check array loaded from cloud")):console.log("MATCHED! LOCAL JSTORAGE CONTACT NAME MATCH FOR PHONE_NUM_CLEAN: "+b.phone_num_clean);void 0==c?_5f4240ca7eb7e3c1748ce1230ac93093f6e54c9b("contactobj is undefined.  phone num clean: "+
b.phone_num_clean,"red"):(c=$.jStorage.get(username_prefix_jstrg_purpose+"|PH_PIC_"+b.phone_num_clean,"no-jstorage-val-found"),"no-jstorage-val-found"==c?(setTimeout(function(){_737f2a042444e04636c24f976d65ef2d8c6e052d(b.phone_num,b.phone_num_clean)},500*a),console.log("NO CONTACT PHOTO LOCAL JSTORAGE MATCH FOR PHONE_NUM_CLEAN: "+b.phone_num_clean)):console.log("CONTACT PHOTO MATCH LOCAL JSTORAGE MATCH FOR PHONE_NUM_CLEAN: "+b.phone_num_clean))})}})}
function _c0393605f3845c66ec755bceadcf5fdfb6b0d8ba(){if(1>globalPHONEContactsRefreshCacheQueue.length)return!1;var a=globalPHONEContactsRefreshCacheQueue.shift(),b=a[1];$("#thumbnail-if-known-"+a[0]).attr("src",b);0<globalPHONEContactsRefreshCacheQueue.length&&setTimeout(asyncLoopThroughLocalStoragePHONEThumbnailsAndDisplay,100)}
function _737f2a042444e04636c24f976d65ef2d8c6e052d(a,b,c){$.ajax({url:baseUrl+"/phonecontact",type:"POST",data:{"function":"getPhoneContactPhotos",phone_num_clean:b,phone_num_full:a},dataType:"json",success:function(a,c,f){0<a.phone_contact_photo_status.length&&(c=a.phone_contact_photo_status,a="0"==a.phone_contact_photo_status?2:"NO_PHOTO"==c?7:30,_5f4240ca7eb7e3c1748ce1230ac93093f6e54c9b("Thumbnail returned for: "+b+", at "+new Date+"storing it for: "+a+" days. ","red"),$.jStorage.set(username_prefix_jstrg_purpose+
"|PH_PIC_"+b,{contactThumbnailBinary:c},{TTL:864E5*a}))}})}function _fd788344f8ead704356938ed655c3325989a6b61(a){$.ajax({url:baseUrl+"/phonecontact?function=getPhoneContacts",type:"GET",dataType:"json",success:function(b,c,d){_1c0ae49900e3722e2bab4effb0d09a4e7da9f4e6(b);a&&a()}})}
function _1c0ae49900e3722e2bab4effb0d09a4e7da9f4e6(a){if(0==a.contacts_status)return _5f4240ca7eb7e3c1748ce1230ac93093f6e54c9b("No Phone contacts in cloud for this user","red"),!1;$.each(a,function(a,c){var b="";c.hasOwnProperty("contactId");c.hasOwnProperty("displayName")&&(b=c.displayName);c.hasOwnProperty("phoneList")&&$.each(c.phoneList,function(a,c){var d="",e="";c.hasOwnProperty("type")&&(d=c.type);c.hasOwnProperty("phoneNumber")&&(e=c.phoneNumber);cleanPhoneNum=_b64bdd522abebf44f807721875afe5597b86403d(e);
contactsFromPhoneGlobal.push({phoneNum:e,phoneNumType:d,phoneNumClean:cleanPhoneNum,contactName:b})})})}
function _1c3fdd65ce756c363b7549fb76d3b1a2ad376495(a,b){$.ajax({type:"GET",url:"https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js",cache:!1,dataType:"text",timeout:8E3,success:function(b,d,e){_5f4240ca7eb7e3c1748ce1230ac93093f6e54c9b("CheckRegularInternetConnection succeeded!","#74AAD8","14px");a&&a()},error:function(){b&&b();_5f4240ca7eb7e3c1748ce1230ac93093f6e54c9b("Error:  Unable to fetch "+this.url+", so there must be an issue with the user's internet connectivity","#74AAD8","14px")}})}
function _9a6a8446c312f655ab37491be4988c206270c241(a,b,c,d){var e=baseUrl+"/client";b={"function":"send",deviceType:"ac2dm",source_client:32,action:a,action_data:b};c&&(b.extra_param=c);console.log("send url for Custom C2DM is: "+e);console.log("post vars string: ",b);$.ajax({url:e,type:"POST",data:b,dataType:"text",timeout:8E3,success:function(b,e,g){time_last_success_mighty_ping=new Date;-1<b.search("sent to phone")?"fetch_binary_from_url_store_on_device"==a||"launch_from_url"==a||"send_snippet_to_phone"==
a?_ee660e73fd4159e6cdb524fb5b68b78faf1b6909(d,!0):"push_phone_contacts_to_cloud"==a&&c&&"user-clicked-clear-contacts-button-so-flush-jstorage"==c&&_e92ee6a9a7e9d9b8d0741277aaefc12f109ca379(!0):("fetch_binary_from_url_store_on_device"==a||"launch_from_url"==a||"send_snippet_to_phone"==a?_ee660e73fd4159e6cdb524fb5b68b78faf1b6909(d,!1):"push_phone_contacts_to_cloud"==a&&c&&"user-clicked-clear-contacts-button-so-flush-jstorage"==c&&_e92ee6a9a7e9d9b8d0741277aaefc12f109ca379(!1),_779768acdbdb4c77805647931ae9ab5f71713b35(a,
b))},error:function(b,e,g){"fetch_binary_from_url_store_on_device"==a||"launch_from_url"==a||"send_snippet_to_phone"==a?_ee660e73fd4159e6cdb524fb5b68b78faf1b6909(d,!1):"push_phone_contacts_to_cloud"==a&&c&&"user-clicked-clear-contacts-button-so-flush-jstorage"==c&&_e92ee6a9a7e9d9b8d0741277aaefc12f109ca379(!1);console.log("Error in C2DM: "+g);console.log("Error details: "+g.error)}})}
function _95d3f58a8397c4ce39fcd6570201a6a346af71d1(a){var b=manifest.version,c=[];c["10.2"]=[];c["10.2"].headline="New! Instantly send pictures from your computer to your phone";c["10.2"].body="\r\nJust right-click on an image on any web page and select 'Send Image to your Phone' and you will see it on your phone instantly.\r\n ";c["12.4"]=[];c["12.4"].headline="New! Text web pages & photos directly from Chrome";c["12.4"].body="Click to learn more.";c["12.5"]=[];c["12.5"].headline="New! Send (almost) anything to your phone";
c["12.5"].body="Instantly send web pages, maps, text snippets, and more...\n\nClick here for details.";c["13.0"]=[];c["13.0"].headline="New Extension Options!";c["13.0"].body="Set preferences for Notifications of incoming messages, phone apps, and more...";c["13.0"].extended_content="Click here to try!";c["15.0"]=[];c["15.0"].headline="New in MightyText Chrome Extension";c["15.0"].body="Notification Sounds, Quick Notification Toggle, New Settings options.";c["15.0"].extended_content="Click to learn more...";
c["15.1"]=[];c["15.1"].headline="Testing";c["15.1"].body="Testing123";a=(new Date(a.ts_creation)).getTime();a=((new Date).getTime()-a)/864E5;c[b]&&1<a?"1"==$.jStorage.get("news_"+b,"no-news-shown-yet")?console.log("news for this version has already been seen"):(a=_3508e249a7f2b6dae514b06f2467b28745bc2c3d({notif_options:{type:"basic",title:c[b].headline,message:c[b].body,iconUrl:"../img/48x48_MT_logo_boom_gradient_white.png",priority:2}}),void 0!=c[b].extended_content&&(a.contextMessage=c[b].extended_content),
chrome.notifications.create("news_notif_"+b,a,function(a){$.jStorage.set("news_"+b,"1");_d6b9fcb67a09bd160cbd5e5ba69e7eae5d02c6a7({notif_id:a,auto_dismiss:!1,notif_sound:!0});_gaq.push(["_trackEvent","CRX",a,"Impression"])})):console.log("no news found for this version.")}
function _40421d6eb1a359f2f822a28b0f0f93da0d4bbf00(a){var b={},c={},d={};"no-internet"==a||"default-icon-on-background-start"==a?(chrome.contextMenus.removeAll(function(){console.log("user is not logged in/there is no internet connectivity, so we should remove all context menus")}),b.path={19:"../img/19x19MT_logo_no_int_conn.png",38:"../img/38x38MT_logo_no_int_conn.png"},d.title="MightyText\n"+_17b88bbdae4990e1a40e4c9175cb0cb5f572c185({key:"browser_action_no_int"}),c.popup="../html/generic.html"):
"user-not-logged-in"==a?(chrome.contextMenus.removeAll(function(){console.log("user is not logged in/there is no internet connectivity, so we should remove all context menus")}),b.path={19:"../img/19x19-mt-signed-out.png",38:"../img/38x38-mt-signed-out.png"},d.title="MightyText\n"+_17b88bbdae4990e1a40e4c9175cb0cb5f572c185({key:"browser_action_no_cookie"}),chrome.browserAction.onClicked.removeListener(_a4205f6e4ede6d5c7572f71a107a0cc2492019c6),chrome.browserAction.onClicked.addListener(_a4205f6e4ede6d5c7572f71a107a0cc2492019c6),
c.popup=""):"user-logged-in"==a?(c.popup="../html/popup.html",window.localStorage.global_notifications&&"0"==window.localStorage.global_notifications?(b.path={19:"../img/19x19-mt-notif-off.png",38:"../img/38x38-mt-notif-off.png"},d.title="MightyText\n"+_17b88bbdae4990e1a40e4c9175cb0cb5f572c185({key:"browser_action_global_notifs_off"})):window.localStorage.message_notifications&&"0"==window.localStorage.message_notifications?(b.path={19:"../img/19x19-mt-notif-off.png",38:"../img/38x38-mt-notif-off.png"},
d.title="MightyText\n"+_17b88bbdae4990e1a40e4c9175cb0cb5f572c185({key:"browser_action_msg_notifs_off"})):(b.path={19:"../img/19x19_MT_logo_boom_gradient_white.png",38:"../img/38x38_MT_logo_boom_gradient_white.png"},d.title="MightyText\n"+_17b88bbdae4990e1a40e4c9175cb0cb5f572c185({key:"browser_action_logged_in"}))):"cannot-connect-to-textyserver"==a&&(chrome.contextMenus.removeAll(function(){console.log("user is not logged in/there is no internet connectivity, so we should remove all context menus")}),
c.popup="../html/generic.html",b.path={19:"../img/19x19_cant_reach_mt.png",38:"../img/38x38_cant_reach_mt.png"},d.title="MightyText\n"+_17b88bbdae4990e1a40e4c9175cb0cb5f572c185({key:"browser_action_unable_to_connect"}));chrome.browserAction.setPopup(c);chrome.browserAction.setTitle(d);chrome.browserAction.setIcon(b)}
function _a4205f6e4ede6d5c7572f71a107a0cc2492019c6(){_kmq.push(["record","user-clicked-browser-action-icon",{browser_action_btn_state:"user-not-logged-in"}]);_92440c6a49a1ac039d5b154cff9c52c68a4d230a()}
function _983553990887ce005a5925a867977368590a26c6(){chrome.tabs.query({currentWindow:!0,url:"https://mightytext.net/*"},function(a){0<a.length?$(a).each(function(b,c){var d=c.url;console.log(c);if(-1<d.indexOf("mightytext.net/web")||-1<d.indexOf("mightytext.net/app"))return chrome.tabs.update(c.id,{active:!0},function(){console.log("User focused in MT App")}),!1;b+1==a.length&&chrome.tabs.create({active:!0,url:"https://mightytext.net/"+currentProductionPath},function(){console.log("new tab of MightyText WebApp created.")})}):
chrome.tabs.create({active:!0,url:"https://mightytext.net/"+currentProductionPath},function(){console.log("new tab of MightyText WebApp created.")})})}
function _6f927c3b054a2be004df39e7f4c5d8765a6babf5(a){$.ajax({url:baseUrl+"/api?function=getUserInfoFull&CLIENT=CRX",type:"GET",timeout:1E4,dataType:"json",error:function(a,c,d){console.log("ERROR in AJAX in getUserInfoFull: "+d)},success:function(b,c,d){console.log(b);b.user_info_full&&0<b.user_info_full.email.length?a?(chrome.notifications.clear("user_not_logged_in"),_1c44fb4dd48d453d8f5dbe5e058ac3fc96cb7789("User-Signed-In-From-Another-Client")):_40421d6eb1a359f2f822a28b0f0f93da0d4bbf00("user-logged-in"):
"user not logged in"==b.user&&_1c44fb4dd48d453d8f5dbe5e058ac3fc96cb7789("User-Signed-Out-From-Another-Client")}})}
chrome.runtime.onMessage.addListener(function(a,b,c){a.new_notify_background_that_user_is_logged_in?(_1c44fb4dd48d453d8f5dbe5e058ac3fc96cb7789("User-Signed-In-From-CRX"),c({reply:"successful_user_login"})):a.notify_crx_from_webapp_signin?(_6f927c3b054a2be004df39e7f4c5d8765a6babf5(!0),c({reply:"notify_crx_from_webapp_signin"})):a.setProperBrowserActionIcon?(_40421d6eb1a359f2f822a28b0f0f93da0d4bbf00("user-logged-in"),c({reply:"setting_browser_action_icon"})):a.reloadCRX?(_1c44fb4dd48d453d8f5dbe5e058ac3fc96cb7789(a.reloadReason),
c({reply:"reloading_crx_now"})):a.userClickedClearContactsButton?(_9a6a8446c312f655ab37491be4988c206270c241("push_phone_contacts_to_cloud","na","user-clicked-clear-contacts-button-so-flush-jstorage"),c({reply:"request_made_phone"})):a.handle_gcm_error?(a.hasOwnProperty("details")&&a.details.hasOwnProperty("action")&&a.details.hasOwnProperty("server_resp")?(b={received_request_to_handle_gcm_error:!0},_779768acdbdb4c77805647931ae9ab5f71713b35(a.details.action,a.details.server_resp)):(console.error(a),
b={error_with_message_to_handle_gcm_errors:!0}),c(b)):a.hasOwnProperty("get_username_prefix")?c({username_prefix:username_prefix_jstrg_purpose}):a.hasOwnProperty("user_loaded_phone_notif_live_view")?_423db1f11b3c2759614f7fce4b20d53d7b8ce813():a.hasOwnProperty("check_user_pro_status")&&c({user_is_pro:isAProUser})});
function _423db1f11b3c2759614f7fce4b20d53d7b8ce813(){setTimeout(function(){if("undefined"!=typeof global_time_last_push_rcvd){var a=new Date,b=(a-global_time_last_push_rcvd)/1E3,c="false",d={ts_last_capi_rcvd_lt_30_secs_ago:!1};30>b&&(c="true",d.ts_last_capi_rcvd_lt_30_secs_ago=!0);console.info("checking when the last time a user received a PUSH to determine if they have a healthy PUSH socket",{now:a,ts_last_capi_rcvd:global_time_last_push_rcvd,time_diff:b});console.info("last push rcvd analytics event details",
{action:"pnlv-triggered-ts-since-last-capi-rcvd",label:c,properties:d});_gaq.push(["_trackEvent","CRX","pnlv-triggered-ts-since-last-capi-rcvd",c]);_kmq.push(["record","pnlv-triggered-ts-since-last-capi-rcvd",d])}},5E3)}
function _779768acdbdb4c77805647931ae9ab5f71713b35(a,b){if(-1<b.indexOf("LOGIN_REQUIRED"))_gaq.push(["_trackEvent","CRX","C2DM-Error","LOGIN_REQUIRED",1]),_17b88bbdae4990e1a40e4c9175cb0cb5f572c185({key:"error_not_logged_in"}),_40421d6eb1a359f2f822a28b0f0f93da0d4bbf00("user-not-logged-in"),_bb8e340c9454e1a89957aaef19ce60280313d3eb();else{if(-1<b.indexOf("DEVICE_NOT_REGISTERED")){_gaq.push(["_trackEvent","CRX","C2DM-Error","DEVICE_NOT_REG",1]);var c=_17b88bbdae4990e1a40e4c9175cb0cb5f572c185({key:"error_not_registered"})}else-1<
b.indexOf("DeviceQuotaExceeded")?(_gaq.push(["_trackEvent","CRX","C2DM-Error","DEVICE_QUOTA_EXCEEDED",1]),c=_17b88bbdae4990e1a40e4c9175cb0cb5f572c185({key:"error_phone_quota_exceeded"})):(_gaq.push(["_trackEvent","CRX","C2DM-Error","GENERAL C2DM ERROR",1]),c=_17b88bbdae4990e1a40e4c9175cb0cb5f572c185({key:"gen_c2dm_error"})+b,_gaq.push(["_trackEvent","CRX","Specific-C2DM-Error",a+"-C2DM-ERROR",1]));alert(c)}}
function _f5b5f2dccc9776a9e6c351a57c72135c2cd40d10(){var a=NEW_COUNT_GLOBAL_NOTIF;10<NEW_COUNT_GLOBAL_NOTIF&&(a="10plus");_gaq.push(["_trackEvent","CRX-Background","Error","getUserInfo-CRX-GU72-"+a,1]);console.log("----------------");NEW_COUNT_GLOBAL_NOTIF++;2>NEW_COUNT_GLOBAL_NOTIF&&(a=_3508e249a7f2b6dae514b06f2467b28745bc2c3d({notif_options:{type:"basic",priority:2,title:_17b88bbdae4990e1a40e4c9175cb0cb5f572c185({key:"mt_connection_issue_notif_title"}),message:_17b88bbdae4990e1a40e4c9175cb0cb5f572c185({key:"mt_connection_issue_notif_content"}),
iconUrl:"../img/notifications/error_icon.png"}}),chrome.notifications.create("connection-error-GU72",a,function(a){_d6b9fcb67a09bd160cbd5e5ba69e7eae5d02c6a7({notif_id:a,auto_dismiss:!1,notif_sound:!0})}));_40421d6eb1a359f2f822a28b0f0f93da0d4bbf00("cannot-connect-to-textyserver")}
function _40fcc753c277a76d6986a340c219006a3995f7a9(){_gaq.push(["_trackEvent","CRX-Background","Error","getDistinctHeaders-CRX-GTHRD59",1]);if(1>NEW_COUNT_GLOBAL_NOTIF){var a=_3508e249a7f2b6dae514b06f2467b28745bc2c3d({notif_options:{type:"basic",priority:2,title:_17b88bbdae4990e1a40e4c9175cb0cb5f572c185({key:"mt_sys_issues_notif_title"}),message:_17b88bbdae4990e1a40e4c9175cb0cb5f572c185({key:"mt_sys_issues_notif_content"}),iconUrl:"../img/notifications/error_icon.png"}});chrome.notifications.create("distinct-header-error-GTHRD59",
a,function(a){_d6b9fcb67a09bd160cbd5e5ba69e7eae5d02c6a7({notif_id:a,auto_dismiss:!1,notif_sound:!0})})}}function ___getPhoneStatus(){global_count_request_phone_status++;1E4>global_count_request_phone_status?_9a6a8446c312f655ab37491be4988c206270c241("get_phone_status","check-phone-status-not-needed"):_1c44fb4dd48d453d8f5dbe5e058ac3fc96cb7789("Get-Phone-Status-10000-Attempt-Reached")}
function _e7df098333b256a940616db6e092f01559c8c391(){var a=window.localStorage,b=!1;void 0===a.notif_battery_fully_charged&&(a.notif_battery_fully_charged=1);void 0===a.notif_battery_low&&(a.notif_battery_low=1);void 0===a.global_notifications&&(a.global_notifications=1);void 0===a.message_notifications&&(a.message_notifications=1,b=!0);void 0===a.phone_app_notifications&&(a.phone_app_notifications=1);void 0===a.notif_content&&(a.notif_content=1,b=!0);void 0===a.notif_auto_dismiss&&(a.notif_auto_dismiss=
1,b=!0);void 0===a.notif_auto_dismiss_time&&(a.notif_auto_dismiss_time=600,b=!0);void 0===a.notif_sound_mode&&(a.notif_sound_mode=0);void 0===a.notif_sound_tone&&(a.notif_sound_tone="Proxima.ogg");b&&setTimeout(function(){"function"==typeof ___getUserLegacyServerSettings?___getUserLegacyServerSettings():_5f4240ca7eb7e3c1748ce1230ac93093f6e54c9b("___getUserLegacyServerSettings is not defined!!","red")},5E3)}
function _cc921bad2b1ad9168e4b3743ae15cfc2d1f0ba60(){var a=document.body.appendChild(document.createElement("iframe"));a.src="https://mightytext.net/prod-assets/chrome_ext_heartbeat";a.height=0;a.onload=function(){console.log("set localstorage of CRX alive via iframe")}}
function _1c44fb4dd48d453d8f5dbe5e058ac3fc96cb7789(a){a||(a="Unknown");10>Math.floor(100*Math.random())&&(_gaq.push(["_trackEvent","CRX-Background","CRX-Forced-Reload-Sample-10pct",a]),_dfded40a64ade884da3d1dee87ecf511f75fc81d({callback:function(a){"undefined"!=typeof a&&a.hasOwnProperty("num_notifs")&&_gaq.push(["_trackEvent","CRX-Background","CRX-Pre-Forced-Reload-Notif-Count-Sample-10pct",a.num_notifs.toString()])}}));setTimeout(function(){window.location.reload()},1E3)}
function _dfded40a64ade884da3d1dee87ecf511f75fc81d(a){chrome.notifications.getAll(function(b){console.info(new Date+" num chrome notifs:"+Object.keys(b).length,b);b=Object.keys(b).length;"undefined"!=typeof a&&a.hasOwnProperty("callback")&&a.callback({num_notifs:b})})}function _92440c6a49a1ac039d5b154cff9c52c68a4d230a(){chrome.tabs.create({url:signInUrlCRX},function(){console.log("new tab of signInURL created")})}function _36560a2e9dd8c62fb5960626c698bac7c1e8572e(){return!1}
function _96e43ca09b9d1d84dbc17c4af23e900d6c3c9b41(){chrome.browserAction.getTitle({},function(a){_5f4240ca7eb7e3c1748ce1230ac93093f6e54c9b("Inside of _96e43ca09b9d1d84dbc17c4af23e900d6c3c9b41. Current BA tooltip content: "+a,"#FF8DC6","14px");if(-1<a.indexOf("Please check your internet connection"))if(_5f4240ca7eb7e3c1748ce1230ac93093f6e54c9b("BA indicates user has no internet connectivity.  Confirming...","#FF8DC6","14px"),navigator.onLine)_1c3fdd65ce756c363b7549fb76d3b1a2ad376495(function(){_1c44fb4dd48d453d8f5dbe5e058ac3fc96cb7789("Browser-Action-Incorrect-No-Int")});
else return!1;else-1<a.indexOf("Not Logged In")&&(_5f4240ca7eb7e3c1748ce1230ac93093f6e54c9b("BA indicates user is not signed into MT.  Confirming that they have internet connectivity.","#FF8DC6","14px"),navigator.onLine?_1c3fdd65ce756c363b7549fb76d3b1a2ad376495("",function(){_1c44fb4dd48d453d8f5dbe5e058ac3fc96cb7789("Browser-Action-Incorrect-Not-Logged-In")}):_1c44fb4dd48d453d8f5dbe5e058ac3fc96cb7789("Browser-Action-Not-Logged-In-Wrong"))})}
function ___getUserLegacyServerSettings(a){$.ajax({url:baseUrl+"/usersettings?function=getUserSettings",type:"POST",dataType:"json",success:function(b){void 0!=b.usersettings.settings_list&&(b=jQuery.parseJSON(b.usersettings.settings_list.value),"undefined"!=typeof a&&a.hasOwnProperty("reminders_exp_flag_key")?(a.user_settings=b,_2ba452d0ec6e09fa61c6ec6fc0e8e09dade74ec9(a)):_debcbf9b572177fd2ddc11d05c6c9de5f72a56bd(b))}})}
function _debcbf9b572177fd2ddc11d05c6c9de5f72a56bd(a){var b=a.notif_toggle_on_off,c=a.notif_content;a=a.notif_dismiss_time;var d=window.localStorage;console.log({toggle:b,privacy:c,dismiss:a});b&&"0"==b&&(d.message_notifications=0);c&&"1"==c&&(d.notif_content=0);a&&"9999"!=a&&60>parseInt(a)&&(d.notif_auto_dismiss=1,"30"==a&&(a="20"),d.notif_auto_dismiss_time=a)}
function _34e8844d2acec55e8ddb17eaf967187c7baf1b6b(a){a&&___clearJstorage(!0);_67e82b618d4c7cb75ec3ed03ddeab5c094c155d2();_fd788344f8ead704356938ed655c3325989a6b61();setTimeout(function(){_d13e3f092238f4536bd8166186d16a5abec1ba2e()},2E3)}function _e92ee6a9a7e9d9b8d0741277aaefc12f109ca379(a){chrome.runtime.sendMessage({refreshContactsFromPhoneC2DMSent:!0,status:a},function(a){console.log(a)})}
function _1964eccb3fb4dd513a0b2980e5f15a4b7a4fc786(a){$(contactsFromPhoneGlobal).each(function(a,c){var b=username_prefix_jstrg_purpose+"|PC_"+c.phoneNumClean;"contact-not-found-in-jstorage"!=$.jStorage.get(b,"contact-not-found-in-jstorage")&&$.jStorage.deleteKey(b)});a&&a()}function _67e82b618d4c7cb75ec3ed03ddeab5c094c155d2(){contactsFromPhoneGlobal=[]}
function _9387abc66ab5752d7e106ec6c426f657050d2fb7(){_fd788344f8ead704356938ed655c3325989a6b61(function(){_d13e3f092238f4536bd8166186d16a5abec1ba2e()})}function _a8f2823c341af5dcabb327d2596824740bd3c308(){chrome.idle.queryState(globalSystemIdleStatusThresholdInSeconds,function(a){_5f4240ca7eb7e3c1748ce1230ac93093f6e54c9b('Setting var globalLastKnownSystemStatus to: "'+a+'"',"purple");globalLastKnownSystemStatus=a})}chrome.idle.setDetectionInterval(globalSystemIdleStatusThresholdInSeconds);
chrome.idle.onStateChanged.addListener(function(a){"active"==a&&"locked"==globalLastKnownSystemStatus&&(_a1ead672229f200085f6eddfef8922fa652841ea(),_5f4240ca7eb7e3c1748ce1230ac93093f6e54c9b("the system was locked, but became active","orange"));globalLastKnownSystemStatus=a;_5f4240ca7eb7e3c1748ce1230ac93093f6e54c9b("System status changed to: "+a+" at: "+new Date,"orange")});
function _9660ed269440e08ad030d1e160f030ac78f892f9(a){"exp-flag-not-set"==$.jStorage.get("mt_reminders_experiment","exp-flag-not-set")&&___getUserLegacyServerSettings({reminders_exp_flag_key:"mt_reminders_experiment",user_info:a})}
function _2ba452d0ec6e09fa61c6ec6fc0e8e09dade74ec9(a){var b=a.user_info,c=a.user_settings,d=a.reminders_exp_flag_key;chrome.runtime.getPlatformInfo(function(a){var e="unknown";"mac"==a.os?e="Mac":"win"==a.os&&(e="Windows");chrome.tabs.query({active:!0,currentWindow:!0},function(a){0<a.length&&(a=a[0].height,a={phone_apk_version:parseFloat(b.current_app_version),os:e,browser:"Chrome",viewport_height:a,is_pro:isAProUser,phone_lang:c.language,crx_version:manifest.version,client:"crx"},a=JSON.stringify(a),
$.ajax({type:"POST",url:baseUrl+"/bridge?function=checkIfUserIsInRemindersExp",data:{client_details:a},dataType:"json",success:function(a){console.info(a);a.hasOwnProperty("status")&&"true"==a.status&&$.jStorage.set(d,"user-in-exp")},error:function(a,b,c){console.error(new Date+" an error occurred while checking user's reminder exp status: "+b)}}))})})}
function _7684cc29265e045bef95ba3ea65cd8b008061a37(){chrome.notifications.create("inject-into-all-tabs",{type:"basic",priority:2,title:"New: Dial a number from any website",message:"Interested in making calls from your computer?",contextMessage:"(With your android phone number)",iconUrl:"../img/48x48_MT_logo_boom_gradient_white.png",buttons:[{title:"Sure!"},{title:"Maybe Later"}]})}
function _96e0ec152304cf5ddeeadb6050c268de8d4160b8(){chrome.permissions.getAll(function(a){console.info("Permissions granted as of: "+new Date,a)})}function _093e0fb50046a85698ac1fbb3cd38d4ff0f80e2e(){chrome.permissions.remove({origins:["*://*/*"]},function(a){})}chrome.permissions.contains({origins:["*://*/*"]},function(a){a&&_6b14cd4b0b19df6b01d3510175f2d5c957afd83e()});
function _13b8ace5cb390790c2cea0131b8eb032b947dabf(a){chrome.tabs.sendMessage(activeTabID,{content_script_check:!0},function(a){console.info("in response of content script check chrome tab message",a);"undefined"==typeof a&&chrome.tabs.executeScript(activeTabID,{file:"scripts/libs/jquery-2.1.0.min.js"},function(){console.log("executed jquery");chrome.tabs.executeScript(activeTabID,{file:"scripts/common.js"},function(){console.log("inserted common.js");chrome.tabs.executeScript(activeTabID,{file:"scripts/content_script.js"},
function(){console.log("executed content_script.js")})})})})}function _6b14cd4b0b19df6b01d3510175f2d5c957afd83e(){chrome.webNavigation.onCompleted.addListener(function(a){console.info("webNavigation completed",a)});chrome.tabs.onActivated.addListener(function(a){console.info("tab activated",a)});chrome.tabs.onUpdated.addListener(function(a){console.info("tab updated",a)})}
function _f7a4d37d0087403dd78af0d782d92a5b7740fe9a(){chrome.notifications.create("lower-priority-notif"+_c74b7efa9d15c055a086e9938f6bac8ac50e9b11(0,100),{},function(a){console.info("low priority notif created",a)})}var acceptedOverrideLSKeys=["webapp_path_override"];
function ___setCRXAdminOverrides(a){var b=new Date+" Something went wrong. Check your syntax and try again.";if("undefined"!=typeof a&&a.hasOwnProperty("override")&&"object"==typeof a.override&&!$.isEmptyObject(a.override)){var c=!1,d="set";a.hasOwnProperty("action")&&(d=a.action);$.each(a.override,function(a,f){-1<acceptedOverrideLSKeys.indexOf(a)?("remove"==d?(localStorage.removeItem(a),b='"'+a+'" override removed!'):(localStorage.setItem(a,f),b='"'+a+'" set to "'+f+'"'),c=!0):console.error(new Date+
' Error:  Unrecognized override property: "'+a+'"')});c&&_0e3cf854f489a196e45058d9f8e6a2f51eb1871a({found_callback:function(a){"undefined"!=typeof a&&a.hasOwnProperty("override_value")&&(a=a.override_value,null!=a&&"string"==typeof a&&(console.error(a),currentProductionPath=a))}})}return b}_0e3cf854f489a196e45058d9f8e6a2f51eb1871a({found_callback:function(a){"undefined"!=typeof a&&a.hasOwnProperty("override_value")&&(a=a.override_value,null!=a&&"string"==typeof a&&(currentProductionPath=a))}});
function _0e3cf854f489a196e45058d9f8e6a2f51eb1871a(a){var b=!1;$(acceptedOverrideLSKeys).each(function(c,d){if(null!=localStorage.getItem(d)&&"webapp_path_override"==d){var e=localStorage.getItem("webapp_path_override");"undefined"!=typeof a&&a.hasOwnProperty("found_callback")&&a.found_callback({override_value:e});b=e}});return b}
function _fde1b01088c52f787ae8ba8f2f3aaf6e78466a4e(){chrome.notifications.create({title:"MightyText",type:"basic",message:"normal message",expandedMessage:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean porta nibh condimentum risus aliquet, quis malesuada risus aliquet. Curabitur ut pulvinar ipsum. Maecenas nec tortor in tellus convallis tristique eu id elit. Mauris sodales eget nullam.",priority:2,iconUrl:"../img/48x48_MT_logo_boom_gradient_white.png",eventTime:Date.now(),contextMessage:"7:33PM",
buttons:[{title:"button #1",iconUrl:"../img/notifications/settings.png"},{title:"button #2",iconUrl:"../img/notifications/settings.png"}]},function(a){})}
function _6241f70323d5d16bac64e9713720689edd8c5f52(a){console.log("--------Checking outbound internet connection");$.ajax({type:"GET",url:"https://ajax.googleapis.com/ajax/libs/webfont/1.3.0/webfont.js",cache:!1,dataType:"html",success:function(b){console.log("Network ping for checking js file on google server...Success");a()},error:function(){console.log("Network ping for checking js file on google server...FAILED")}})};