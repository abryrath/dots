var pushProvider="mt",pushPayloadBabysitterArray=[],userIsDefaultPushServiceCapable=!1,timeBeforeCheckForPushServiceEnabled=18E3,PushServiceBabysitterIntervalDetails={id:"",interval:generateBabysitterIntervalInMS(),body:_09b555e311df7b4abe54a037d5dd9869ea377e44()},PUSHHealthCheckInterval={id:"",interval:1E4,body:"CAPI_HEALTH_CHECK_WEBAPP_NOV_2017"},globalTsLastPushRcvd=new Date-6E4;
function _32bceb0097a3e1a078a6194112afb7381ad79e40(){"frd"==pushProvider?_8cbec146db430311ea0c6e06056542b8122cacc9():"pusher"==pushProvider?_cee86ad928331cd1247c2a2ad7915f8a3b12970d():_c820acdb9b07675cd18ab2f3adff7191c6f8114e({init_app_load:!0})}function _01bfdfd236a2e4ba45c7f26c51f1b8dc02f6e32a(){"pusher"==pushProvider?_6da7ef84d4f30b85fafadfa578e6cd2668dcc4ce():_61e53086f8093861ec1fa866e1510e06155519fa()}
function _cf94feae83b29d72ea66153ef1ea100664fbc29e(){"function"==typeof closePusherSocket&&closePusherSocket()}
function _c83649b1b98bfac47f7d22d4787ab79f85f2d1ea(){var a="push-service-not-compatible",b=0;userIsDefaultPushServiceCapable?(a="push-service-compatible",b=1):_5276b5584e6156b37336e226a43b1ad6e8a70810("Oh no! User is not compatible w/ our current push provider.","error");_1c3f31d45ecdbac9ceb6d068644be1b8db7fa3c9({push_type:"push-service-compatibility",sub_type:pushProvider,attempt:1,success:b});_5276b5584e6156b37336e226a43b1ad6e8a70810("[PUSH SERVICE CAPABILITY CHECK] User is "+a)}
function _5276b5584e6156b37336e226a43b1ad6e8a70810(a,b,c){a="[PUSH]["+pushProvider.toUpperCase()+"] "+a;"native-app"==clientRunningScript?writeToDesktopLog(a):"undefined"!=typeof b&&"error"==b?"undefined"!=typeof c?console.error(a,c):console.error(a):"undefined"!=typeof c?console.log(a,c):console.log(a)}
function _4b09b1ad2f367864381042390902915b3a159215(a){if(-1<pushPayloadBabysitterArray.indexOf(a.id)){_5276b5584e6156b37336e226a43b1ad6e8a70810("PUSH Health Check ID: "+a.id+" did not come back in 5 seconds. Removing ID from babysitter array whose current length is "+pushPayloadBabysitterArray.length);pushPayloadBabysitterArray.splice(pushPayloadBabysitterArray.indexOf(a.id),1);var b={attempt:1,success:0};"type"in a&&(b.push_type=a.type);"sub_type"in a&&(b.sub_type=a.sub_type);_1c3f31d45ecdbac9ceb6d068644be1b8db7fa3c9(b);
_5276b5584e6156b37336e226a43b1ad6e8a70810("PUSH Health Check ID: "+a.id+" did not come back in 5 seconds. Removed ID from babysitter array whose NEW length is "+pushPayloadBabysitterArray.length)}}
function _3221add75ae8d2697c3a097b1a8c31ed7efdfe63(a,b){if("data"in a&&"undefined"!=typeof PushServiceBabysitterIntervalDetails&&-1<a.data.search(PushServiceBabysitterIntervalDetails.body)){var c={};_5276b5584e6156b37336e226a43b1ad6e8a70810("Received valid Babysitter payload JSON "+a.data);try{c=JSON.parse(a.data)}catch(f){_5276b5584e6156b37336e226a43b1ad6e8a70810("!!! and error occurred while trying to parse the incoming Babysitter json string: "+JSON.stringify(err),"error")}if("new_content"in c){var d=
c.new_content;c=(new Date).getTime();tsSend=d.body.split(" ");var e=tsSend[0];_5276b5584e6156b37336e226a43b1ad6e8a70810("Body JSON w/o timestamp: "+e);d={};try{d=JSON.parse(e)}catch(f){_5276b5584e6156b37336e226a43b1ad6e8a70810("An error occurred while trying to parse the BODY of an incoming Electron CAPI Health Check","error")}"id"in d&&"undefined"!=typeof pushPayloadBabysitterArray&&-1<pushPayloadBabysitterArray.indexOf(d.id)&&(_5276b5584e6156b37336e226a43b1ad6e8a70810("Babysitter ID: "+d.id+" found in PUSH Babysitter Array (current length: "+
pushPayloadBabysitterArray.length+")"),pushPayloadBabysitterArray.splice(pushPayloadBabysitterArray.indexOf(d.id),1),_5276b5584e6156b37336e226a43b1ad6e8a70810("Babysitter ID: "+d.id+" removed from PUSH Babysitter Array (new length: "+pushPayloadBabysitterArray.length+")"),tsSend=parseInt(tsSend[tsSend.length-1]),_5276b5584e6156b37336e226a43b1ad6e8a70810("Push Babysitter payload rcvd.  Time diff between send & receipt: "+(c-tsSend)+"ms"),c={attempt:1,success:1,completion_time:(c-tsSend)/1E3,push_type:pushProvider},
"sub_type"in d&&(c.sub_type=d.sub_type),_1c3f31d45ecdbac9ceb6d068644be1b8db7fa3c9(c))}}}
function _d29b4927aa52b076e9b7c71830f53e6ba20fad14(a){_1c3f31d45ecdbac9ceb6d068644be1b8db7fa3c9({push_type:"push-socket-open",sub_type:pushProvider,attempt:1,success:1,completion_time:0});_5276b5584e6156b37336e226a43b1ad6e8a70810("Sending inital push babysitter because we just established a socket for: "+pushProvider);_7fc749c3a1474232837764b50bdfee28c67a1e9b();setTimeout(function(){_5276b5584e6156b37336e226a43b1ad6e8a70810("Sending inital push babysitter because we just established a socket for: "+pushProvider);
_a14bf8bbb6157d94859bcf4d1661807170743ab3({type:pushProvider,sub_type:"triggered-by-socket-open"})},3E3);_e72af827b355c4264cf0d8dea0561b9623139fac()}function _b79e263206af68c8e08a3030b1a384316d3051a4(){_1c3f31d45ecdbac9ceb6d068644be1b8db7fa3c9({push_type:"push-socket-close",sub_type:pushProvider,attempt:0,success:0,completion_time:0})}
function _dfe10a88228c98cb99e62bb446f7a99b679bfad3(){_106ed4a420ba5008b4d3d0ef4769184e4cc9889f();setTimeout(function(){PUSHHealthCheckInterval.id=setInterval(_2ea21a6c2ca30408e24a7b238f05ce88b3c0d233,PUSHHealthCheckInterval.interval)},2E4)}
function _2ea21a6c2ca30408e24a7b238f05ce88b3c0d233(){_5276b5584e6156b37336e226a43b1ad6e8a70810("In Body JSON w/o timestamp");var a=getSecondsSinceLastPushRcvd();_5276b5584e6156b37336e226a43b1ad6e8a70810("Last PUSH inbound received "+a+" seconds ago");200<a?(_5276b5584e6156b37336e226a43b1ad6e8a70810("It's been > 200 seconds since last PUSH! do one last health check attempt before opening a new Push socket..."),_6241f70323d5d16bac64e9713720689edd8c5f52(_01bfdfd236a2e4ba45c7f26c51f1b8dc02f6e32a)):180<
a?(sendCAPITestMessageFromWebApp(PUSHHealthCheckInterval.body),_5276b5584e6156b37336e226a43b1ad6e8a70810("It's been more than 180 seconds, so issue a Push Health Check")):_5276b5584e6156b37336e226a43b1ad6e8a70810("It's been less than 180 seconds, so no need to issue a new Push health check")}function _09b555e311df7b4abe54a037d5dd9869ea377e44(){return"CAPI_HEALTH_CHECK_FOR_"+pushProvider.toUpperCase()+"_2017_FROM_WEBAPP"}
function _a14bf8bbb6157d94859bcf4d1661807170743ab3(a){a=void 0===a?{}:a;var b=_9e6ed81be0a6ecebbc92eef95afac1bf4a8adce3(10);pushPayloadBabysitterArray.push(b);var c={body:PushServiceBabysitterIntervalDetails.body,id:b};"sub_type"in a&&"triggered-by-socket-open"==a.sub_type&&(c.sub_type=a.sub_type);c=JSON.stringify(c);$.ajax({url:baseUrl+"/test?function=capi",data:{body:c+" ---- "+(new Date).getTime(),phone_num:555555555},global:!1,type:"POST",dataType:"text",xhrFields:{withCredentials:!0},success:function(c){-1!=
c.search("CAPI test sent successfully")&&setTimeout(function(){$.extend(a,{id:b,deadline:5E3});_4b09b1ad2f367864381042390902915b3a159215(a)},5E3)}})}
function _7fc749c3a1474232837764b50bdfee28c67a1e9b(){clearInterval(PushServiceBabysitterIntervalDetails.id);PushServiceBabysitterIntervalDetails.body=_09b555e311df7b4abe54a037d5dd9869ea377e44();_5276b5584e6156b37336e226a43b1ad6e8a70810("Setting Push Babysitter Interval for: "+pushProvider);PushServiceBabysitterIntervalDetails.id=setInterval(function(){_a14bf8bbb6157d94859bcf4d1661807170743ab3({type:pushProvider})},PushServiceBabysitterIntervalDetails.interval)}
function _106ed4a420ba5008b4d3d0ef4769184e4cc9889f(){try{clearInterval(PUSHHealthCheckInterval.id)}catch(a){console.error("An error occurred trying to close the legacy CAPI Health Check Interval: "+a),_kmq.push(["record","Clear-Legacy-CAPI-Health-Check-Interval-Error",{legacy_capi_health_check_clearinterval_check_error:a}])}}
function _1c3f31d45ecdbac9ceb6d068644be1b8db7fa3c9(a){var b={push_type:"pusher",session_id:_9e6ed81be0a6ecebbc92eef95afac1bf4a8adce3(15)};$.extend(b,a);_31766a4c5c1786c575b42c7e777d2a0df57fd5e0({event:{name:"event_push_stats",options:b}})

	try{
		var acceptedPushTypes = ["frd", "pusher", "mt"];
		
		if(acceptedPushTypes.indexOf(b.push_type) > -1){	//only want to record an event for push babysitters, not push socket opens, closes, etc. 4.10.18 KL
			recordMTLiveLoggerEvent({
				event: b
			});					
		}
	} catch(err){
		console.error("Error occurred recording mt logger event", err);
	}

}var userOS="unknown";_80725263409b016dc01f9252dd359c056ed3ca67();
function _80725263409b016dc01f9252dd359c056ed3ca67(){if("undefined"!=typeof clientRunningScript&&"CRX"==clientRunningScript)try{chrome.runtime.getPlatformInfo(function(a){"undefined"!=typeof a&&"os"in a&&"string"==typeof a.os&&(userOS=a.os,userOS=userOS.charAt(0).toUpperCase()+userOS.slice(1))})}catch(a){console.error("Unable to determine the user's OS for babysitter event: "+a)}}
function _8cbec146db430311ea0c6e06056542b8122cacc9(a){$.ajax({type:"GET",url:"https://www.gstatic.com/firebasejs/4.1.3/firebase.js",dataType:"script",success:function(){_5276b5584e6156b37336e226a43b1ad6e8a70810("Success! Retrieved FRD JS Lib");_160928176a351b2d72c81727c96a8aa2c6643c2f()},error:function(){_5276b5584e6156b37336e226a43b1ad6e8a70810("Unable to retrieve FRD JS Lib","error")}})}
function _afaed588c4e02b09e9515b381b458c329a2de73e(a){a=void 0===a?{}:a;if("attempt"in a){var b=a.attempt;a="https://content.mightytext.net/app-info/data.php"+_1f2408cf2ad672d01a2f6ca772f9a3a4f218d0df();$.ajax({type:"GET",url:a,dataType:"json",timeout:3E3,success:function(a){try{console.log("Received a response from /app-info JSON",a),_aa7e9236d3e48dd2592c973c3c74ed0dd3236c66({resp:a,attempt:b})}catch(d){}},complete:function(a,d){console.log("Inside of complete callback for /app-info request",d);
0===b&&_32bceb0097a3e1a078a6194112afb7381ad79e40()}});setTimeout(function(){_afaed588c4e02b09e9515b381b458c329a2de73e({attempt:++b})},9E5)}else console.error("Missing attempt property in data argument for app-info check!")}
function _c724e98a782f0ac88957c64f47e5dd72ae8d1e7c(a){var b=pushProvider;"object"==typeof a&&("web-app"==clientRunningScript&&"webapp_push_provider"in a?b=a.webapp_push_provider:"CRX"==clientRunningScript&&"crx_push_provider"in a?b=a.crx_push_provider:"push_provider"in a&&(b=a.push_provider));console.info("Found the push_provider field!",b,a);return b}
function _aa7e9236d3e48dd2592c973c3c74ed0dd3236c66(a){a=void 0===a?{}:a;var b=_c724e98a782f0ac88957c64f47e5dd72ae8d1e7c(a.resp),c=b.value;b=b.update_type;a=a.attempt;pushProvider!=c&&(0==a?pushProvider=c:"string"==typeof b&&"forced"==b&&("webapp"==clientRunningScript&&alert(getLanguageSpecificText("forced_app_update_available",globalDefaultLanguage)),"CRX"==clientRunningScript?_1c44fb4dd48d453d8f5dbe5e058ac3fc96cb7789("PushProvider-Change"):"webapp"==clientRunningScript&&reloadAppForUpdate({current_version:pushProvider,
new_version:c,update_type:b})))}
function _1f2408cf2ad672d01a2f6ca772f9a3a4f218d0df(){var a="";try{"undefined"!=typeof clientRunningScript&&(a+="?client=","webapp"==clientRunningScript?a+="webapp":"CRX"==clientRunningScript?a+="crx":"native-app"==clientRunningScript&&(a+="desktop")),a+="&app_version=","webapp"==clientRunningScript?a+=cleanVersionGlobal:"CRX"==clientRunningScript?a+=manifest.version:"native-app"==clientRunningScript&&(a+=app.getVersion())}catch(b){console.error("Error building client-specific request URL params for logging purposes",b)}return a}
function _e72af827b355c4264cf0d8dea0561b9623139fac(){clearInterval(pusherActiveClientPollerID);var a=baseUrl+"/client-keepalive"+_1f2408cf2ad672d01a2f6ca772f9a3a4f218d0df()+"&push_type="+pushProvider;pusherActiveClientPollerID=setInterval(function(){$.ajax({type:"GET",url:a,xhrFields:{withCredentials:!0}})},27E5)};

function generateBabysitterIntervalInMS(){
	var interval = 600000;//default to 10 min, in case there is an issue generating the rand int

	try{
		interval = _c74b7efa9d15c055a086e9938f6bac8ac50e9b11(480000, 720000);//randomly setting the interval between 8-12 mins 4.12.18 KL taken from the webapp
	} catch(err){
		console.error("An error occurred while generating rand push babysitter interval", err);
	}
	
	_5276b5584e6156b37336e226a43b1ad6e8a70810("Setting Push Babysitter Interval to: " + interval);
	
	return interval;
}